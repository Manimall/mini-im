import React from 'react'
import {Link} from 'react-router-dom'
import * as R from 'ramda'
import uniqueId from 'lodash.uniqueid';


import Loader from 'components/Shared/Loader'
import Error from 'components/Shared/Error'
import NoResults from 'components/Shared/NoResults'
import GoodsLayout from 'components/GoodsLayout'

import useGetPhones from 'hooks/phones/use-get-phones'
import useAddPhoneToBasket from 'hooks/phones/use-add-phone-to-basket'
import useLoadMorePhones from 'hooks/phones/use-loadmore-phones'


const Phones = () => {

  const { phones, isLoading, error } = useGetPhones();
  const addToBasketCb = useAddPhoneToBasket();
  const loadMorePhones = useLoadMorePhones();

  const renderPhone = (phone) => {
    const shortDescription = `${R.take(60, phone.description)}...`;

    return (
      <div className='col-sm-4 col-lg-4 col-md-4 book-list' key={uniqueId()}>
        <div className='thumbnail'>
          <Link
            to={`/phones/${phone.id}`}
          >
            <img
              className='img-thumbnail'
              src={phone.image}
              alt={phone.name}
            />
          </Link>
          <div className='caption'>
            <h4 className='pull-right'>
              ${phone.price}
            </h4>

            <h4>
              <Link to={`/phones/${phone.id}`} >
                {phone.name}
              </Link>
            </h4>

            <p>{shortDescription}</p>

            <p className='itemButton d-flex justify-content-around'>
              <button
                className='btn btn-primary mr-md-3'
                onClick={() => addToBasketCb(phone.id)}
              >
                Buy Now!
              </button>
              <Link
                to={`/phones/${phone.id}`}
                className='btn btn-default'
              >
                More Info
              </Link>
            </p>
          </div>
        </div>
      </div>
    )
  };

  const renderPhones = () => (
    phones.length > 0 && (
      <section className='books row'>
        {phones.map(renderPhone)}
      </section>
    )
  );


  if (isLoading) return <Loader/>;
  if (error) return <Error/>;
  if (phones.length === 0) return <NoResults/>

  return (
    <GoodsLayout>
      {renderPhones()}
      <div className='row'>
        <div className='col-md-12'>
          <button
            className='btn btn-primary pull-right'
            onClick={loadMorePhones}
          >
            Load More
          </button>
        </div>
      </div>
    </GoodsLayout>
  )
};

export default Phones;
